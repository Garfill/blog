import{_ as s,c as n,o as a,a as l}from"./app.d474d6c4.js";const C=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u66F4\u65B0\u6D41\u7A0B","slug":"\u66F4\u65B0\u6D41\u7A0B","link":"#\u66F4\u65B0\u6D41\u7A0B","children":[]},{"level":2,"title":"\u65B0\u8282\u70B9 mount","slug":"\u65B0\u8282\u70B9-mount","link":"#\u65B0\u8282\u70B9-mount","children":[]},{"level":2,"title":"\u8282\u70B9update","slug":"\u8282\u70B9update","link":"#\u8282\u70B9update","children":[]}],"relativePath":"React/04-diff/4-2.\u5355\u4E00\u8282\u70B9diff.md"}'),p={name:"React/04-diff/4-2.\u5355\u4E00\u8282\u70B9diff.md"},o=l(`<blockquote><p>\u8FD9\u91CC\u8BF4\u7684\u5355\u4E00\u8282\u70B9\u662F\u6307\uFF1A\u66F4\u65B0\u540E\u7684 jsx \u5BF9\u8C61\u662F \u5355\u4E00\u8282\u70B9</p></blockquote><h2 id="\u66F4\u65B0\u6D41\u7A0B" tabindex="-1">\u66F4\u65B0\u6D41\u7A0B <a class="header-anchor" href="#\u66F4\u65B0\u6D41\u7A0B" aria-hidden="true">#</a></h2><p><img src="https://react.iamkasong.com/img/diff.png" alt=""></p><h2 id="\u65B0\u8282\u70B9-mount" tabindex="-1">\u65B0\u8282\u70B9 mount <a class="header-anchor" href="#\u65B0\u8282\u70B9-mount" aria-hidden="true">#</a></h2><blockquote><p><strong>\u65B0\u8282\u70B9 mount</strong> \u8FC7\u7A0B\u6267\u884C \u5DE6\u8FB9\u8DEF\u7EBF\uFF0C\u76F4\u63A5\u751F\u6210\u65B0 Fiber</p></blockquote><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">reconcileSingleElement</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">returnFiber</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">currentFirstFiber</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">element</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">// 1.\u7236\u8282\u70B9</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">// 2.\u5F53\u524DFiber\u8282\u70B9(\u65B0\u8282\u70B9\u4E3Anull)</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">// 3.\u8282\u70B9\u66F4\u65B0\u7684jsx \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">// \u6839\u636E 2 \u548C 3 \u751F\u6210\u65B0\u8282\u70B9</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">element</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">key</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">child</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">currentFirstFiber</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">// ...</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">created</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">createFiberFromElement</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">element</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">returnFiber</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">mode</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">lanes</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">created</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ref</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">coerceRef</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">returnFiber</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">currentFirstChild</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">element</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">created</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">returnFiber</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">// \u8FD4\u56DE\u751F\u6210\u7684\u65B0\u8282\u70B9</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">created</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="\u8282\u70B9update" tabindex="-1">\u8282\u70B9update <a class="header-anchor" href="#\u8282\u70B9update" aria-hidden="true">#</a></h2><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">reconcileSingleElement</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#A6ACCD;">returnFiber</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">currentFirstChild</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">element</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">element</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">key</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">child</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">currentFirstFiber</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">while</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">child</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">child</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;">// \u66F4\u65B0\u524D\u540E key \u76F8\u540C \u800C\u4E14 type \u76F8\u540C</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;">switch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">child</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tag</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">				</span><span style="color:#676E95;">//..</span></span>
<span class="line"><span style="color:#F07178;">				</span><span style="color:#89DDFF;">default</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">					</span><span style="color:#676E95;">// \u6267\u884C \u53EF\u590D\u7528 DOM \u903B\u8F91\uFF08\u53F3\u8FB9\u7EBF\u8DEF\uFF09</span></span>
<span class="line"><span style="color:#F07178;">					</span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">child</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">elementType</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">element</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">type</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">						</span><span style="color:#676E95;">// \u5220\u9664\u540C\u7EA7\u5176\u4ED6\u8282\u70B9</span></span>
<span class="line"><span style="color:#F07178;">						</span><span style="color:#82AAFF;">deleteRemainingChildren</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">returnFiber</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">child</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sibling</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">						</span><span style="color:#676E95;">// \u590D\u7528\u5F53\u524Dchild \u7684 Fiber \u8282\u70B9\uFF0C\u514B\u9686\u51FA\u4E00\u6837\u7684\u8282\u70B9\u8FD4\u56DE</span></span>
<span class="line"><span style="color:#F07178;">						</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">existing</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">useFiber</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">child</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">element</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">props</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">						</span><span style="color:#A6ACCD;">existing</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">type</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">type</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">						</span><span style="color:#A6ACCD;">existing</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">returnFiber</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">						</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">existing</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// \u8FD4\u56DE\u590D\u7528Fiber\u8282\u70B9</span></span>
<span class="line"><span style="color:#F07178;">					</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">					</span><span style="color:#89DDFF;">break</span></span>
<span class="line"><span style="color:#F07178;">				</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;">// key \u76F8\u540C\uFF0C\u4F46\u662F tag \u4E0D\u76F8\u540C</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;">// \u6807\u8BB0 current \u548C \u6240\u6709current.sibling \u5220\u9664</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#82AAFF;">deleteRemainingChildren</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">returnFiber</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">child</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;">// key \u4E0D\u76F8\u540C</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;">// \u6807\u8BB0 current \u5220\u9664</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#82AAFF;">deleteChild</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">returnFiber</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">child</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">child</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">child</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sibling</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">// ...\u751F\u6210\u65B0\u8282\u70B9\u8FD4\u56DE</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div>`,8),t=[o];function e(c,r,F,y,D,i){return a(),n("div",null,t)}const d=s(p,[["render",e]]);export{C as __pageData,d as default};
