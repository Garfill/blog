import{_ as s,c as n,o as a,a as l}from"./app.d474d6c4.js";const d=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[{"level":2,"title":"Diff \u7B97\u6CD5\u5165\u53E3","slug":"diff-\u7B97\u6CD5\u5165\u53E3","link":"#diff-\u7B97\u6CD5\u5165\u53E3","children":[]}],"relativePath":"React/04-diff/4-1.\u7B97\u6CD5\u5165\u53E3.md"}'),p={name:"React/04-diff/4-1.\u7B97\u6CD5\u5165\u53E3.md"},o=l(`<p>\u4E00\u4E2A<code>DOM\u8282\u70B9</code>\u5728\u67D0\u4E00\u65F6\u523B\u6700\u591A\u4F1A\u6709 4\u4E2A \u8282\u70B9\u548C\u4ED6\u76F8\u5173\u3002</p><ol><li><code>current Fiber</code>\u3002\u5982\u679C\u8BE5<code>DOM\u8282\u70B9</code>\u5DF2\u5728\u9875\u9762\u4E2D\uFF0C<code>current Fiber</code>\u4EE3\u8868\u8BE5<code>DOM\u8282\u70B9</code>\u5BF9\u5E94\u7684<code>Fiber\u8282\u70B9</code>\u3002</li><li><code>workInProgress Fiber</code>\u3002\u5982\u679C\u8BE5<code>DOM\u8282\u70B9</code>\u5C06\u5728\u672C\u6B21\u66F4\u65B0\u4E2D\u6E32\u67D3\u5230\u9875\u9762\u4E2D\uFF0C<code>workInProgress Fiber</code>\u4EE3\u8868\u8BE5<code>DOM\u8282\u70B9</code>\u5BF9\u5E94\u7684<code>Fiber\u8282\u70B9</code>\u3002</li><li><code>DOM\u8282\u70B9</code>\u672C\u8EAB\u3002</li><li><code>JSX\u5BF9\u8C61</code>\u3002\u5373<code>ClassComponent</code>\u7684<code>render</code>\u65B9\u6CD5\u7684\u8FD4\u56DE\u7ED3\u679C\uFF0C\u6216<code>FunctionComponent</code>\u7684\u8C03\u7528\u7ED3\u679C\u3002<code>JSX\u5BF9\u8C61</code>\u4E2D\u5305\u542B\u63CF\u8FF0<code>DOM\u8282\u70B9</code>\u7684\u4FE1\u606F\u3002 <code>Diff\u7B97\u6CD5</code>\u7684\u672C\u8D28\u662F\u5BF9\u6BD41\u548C4\uFF0C\u751F\u62102\u3002</li></ol><h2 id="diff-\u7B97\u6CD5\u5165\u53E3" tabindex="-1">Diff \u7B97\u6CD5\u5165\u53E3 <a class="header-anchor" href="#diff-\u7B97\u6CD5\u5165\u53E3" aria-hidden="true">#</a></h2><p>\u5728 <code>reconcileChildren</code> \u8FC7\u7A0B\u4E2D \u8C03\u7528 \u7684 <code>reconcileChildFibers</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// packages/react-reconciles/src/ReactChildFiber.js</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">reconcileChildFibers</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">returnFiber</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">currentFirstChild</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">newChild</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">lanes</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;">//...</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">isObject</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newChild</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">object</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newChild</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">isObject</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// object\u7C7B\u578B\uFF0C\u53EF\u80FD\u662F REACT_ELEMENT_TYPE \u6216 REACT_PORTAL_TYPE</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">switch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">newChild</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">$$typeof</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">	    </span><span style="color:#676E95;">// \u65B0 jsx\u5BF9\u8C61\u7684 \u7C7B\u578B</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">REACT_ELEMENT_TYPE</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;">// \u5355\u4E2A\u5B50\u8282\u70B9</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;">// \u8C03\u7528 reconcileSingleElement \u5904\u7406</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">placeSingleChild</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">reconcileSingleElement</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#A6ACCD;">returnFiber</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#A6ACCD;">currentFirstChild</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#A6ACCD;">newChild</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#A6ACCD;">lanes</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">            )</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">	 </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#82AAFF;">isArray</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">newChild</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">	    </span><span style="color:#676E95;">// \u591A\u4E2A\u5B50\u8282\u70B9 \u8C03\u7528 reconcileChildrenArray \u5904\u7406</span></span>
<span class="line"><span style="color:#F07178;">	    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">reconcileChildrenArray</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">	        </span><span style="color:#A6ACCD;">returnFiber</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">	        </span><span style="color:#A6ACCD;">currentFirstChild</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">	        </span><span style="color:#A6ACCD;">newChild</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">	        </span><span style="color:#A6ACCD;">lanes</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">	    )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newChild</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">string</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newChild</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">number</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u6587\u672C \u8C03\u7528 reconcileSingleTextNode \u5904\u7406</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">placeSingleChild</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">reconcileSingleTextNode</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">returnFiber</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">currentFirstChild</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newChild</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">lanes</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        )</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u4E00\u4E9B\u5176\u4ED6\u60C5\u51B5\u8C03\u7528\u5904\u7406\u51FD\u6570</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u4EE5\u4E0A\u90FD\u6CA1\u6709\u547D\u4E2D\uFF0C\u5220\u9664\u8282\u70B9</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">deleteRemainingChildren</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">returnFiber</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">currentFirstChild</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div>`,5),e=[o];function c(r,t,F,y,D,i){return a(),n("div",null,e)}const A=s(p,[["render",c]]);export{d as __pageData,A as default};
